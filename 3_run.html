
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Main run &#8212; LISFLOOD use cases</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '3_run';</script>
    <link rel="canonical" href="/lisflood-usecases/3_run.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Calibration" href="4_calibration.html" />
    <link rel="prev" title="Warmup run" href="2_warmup.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="README.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/header.png" class="logo__image only-light" alt="LISFLOOD use cases - Home"/>
    <script>document.write(`<img src="_static/header.png" class="logo__image only-dark" alt="LISFLOOD use cases - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="0_general_setup.html">Input and general settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="1_initialization.html">Initialization run</a></li>
<li class="toctree-l1"><a class="reference internal" href="2_warmup.html">Warmup run</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Main run</a></li>
<li class="toctree-l1"><a class="reference internal" href="4_calibration.html">Calibration</a></li>
<li class="toctree-l1"><a class="reference internal" href="5_other_usecases.html">Other use cases</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/3_run.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Main run</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#settings-file">1 Settings file</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#run-the-simulation">2 Run the simulation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#outputs">3 Outputs</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#map-stacks">3.1 Map stacks</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#soil-layers">3.1.1 Soil layers</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#groundwater-zones">3.1.2 Groundwater zones</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#discharge">3.1.3 Discharge</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#reservoir-and-rice-irrigation">3.1.4 Reservoir and rice irrigation</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#water-exploitation-indexes">3.1.5 Water exploitation indexes</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#time-series">3.2 Time series</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">3.2.1 Discharge</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#reservoirs">3.2.2 Reservoirs</a></li>
</ul>
</li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <p><img alt="header" src="_images/header.png" /></p>
<section class="tex2jax_ignore mathjax_ignore" id="main-run">
<h1>Main run<a class="headerlink" href="#main-run" title="Link to this heading">#</a></h1>
<!-- [![Binder](https://mybinder.org/badge_logo.svg)](https://mybinder.org/v2/gh/ec-jrc/lisflood-usecases/mekong_usecase?urlpath=%2Fdoc%2Ftree%2FLF_mekong_usecase%2Fdocs%2Fnotebooks%2F) -->
<br>
<br>
<br>
<p>Once we have done the initialization run and we have estimated the initial conditions in the warmup run, we are in a position to perform our target simulation. We want to simulate the 30 years period between 01-01-1990 and 31-12-2019  in order to estimate the climatology of the hydrological processes in the Nam Ngum River Basin. Remember that in <a class="reference external" href="https://ec-jrc.github.io/lisflood-code/2_ESSENTIAL_time-management/">LISFLOOD time convention</a> these dates correspond to 02-01-1990 and 01-01-2020, respectively.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">xarray</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xr</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.gridspec</span><span class="w"> </span><span class="kn">import</span> <span class="n">GridSpec</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">lisflood_read_plot</span><span class="w"> </span><span class="kn">import</span> <span class="n">plot_mapstacks</span><span class="p">,</span> <span class="n">plot_reservoir</span><span class="p">,</span> <span class="n">read_tss</span>

<span class="n">path_model</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;../LF_mekong_usecase&#39;</span><span class="p">)</span>
<span class="n">path_run</span> <span class="o">=</span> <span class="n">path_model</span> <span class="o">/</span> <span class="s1">&#39;results&#39;</span> <span class="o">/</span> <span class="s1">&#39;run&#39;</span>
</pre></div>
</div>
</div>
</div>
<section id="settings-file">
<h2>1 Settings file<a class="headerlink" href="#settings-file" title="Link to this heading">#</a></h2>
<p>We will introduce a few changes in the settings file (<a class="reference download internal" download="" href="_downloads/9ded7408cfabd4e787074a8ce4460b34/settings_run.xml"><span class="xref download myst"><code class="docutils literal notranslate"><span class="pre">settings_run.xml</span></code></span></a>) compared with the file used in the warmup:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;lfoptions&gt;</span>
<span class="w">    </span>
<span class="w">    </span>[...]
<span class="w">    </span>
<span class="w">    </span>#<span class="w"> </span>option<span class="w"> </span>to<span class="w"> </span>compute<span class="w"> </span>indicators
<span class="w">    </span><span class="nt">&lt;setoption</span><span class="w"> </span><span class="na">choice=</span><span class="s">&quot;1&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;indicator&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span>
<span class="w">    </span>#<span class="w"> </span>report<span class="w"> </span>time<span class="w"> </span>series
<span class="w">    </span><span class="nt">&lt;setoption</span><span class="w"> </span><span class="na">choice=</span><span class="s">&quot;1&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;repDischargeTs&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;setoption</span><span class="w"> </span><span class="na">choice=</span><span class="s">&quot;1&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;repsimulateReservoirs&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span>
<span class="w">    </span>#<span class="w"> </span>report<span class="w"> </span>maps
<span class="w">    </span><span class="nt">&lt;setoption</span><span class="w"> </span><span class="na">choice=</span><span class="s">&quot;1&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;repStateMaps&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;setoption</span><span class="w"> </span><span class="na">choice=</span><span class="s">&quot;0&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;repEndMaps&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;setoption</span><span class="w"> </span><span class="na">choice=</span><span class="s">&quot;1&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;repDischargeMaps&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;setoption</span><span class="w"> </span><span class="na">choice=</span><span class="s">&quot;1&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;repTotalAbs&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;setoption</span><span class="w"> </span><span class="na">choice=</span><span class="s">&quot;1&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;repWIndex&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span>
<span class="w">    </span>[...]
<span class="w">    </span>
<span class="nt">&lt;/lfoptions&gt;</span>
<span class="w">    </span>
<span class="nt">&lt;lfuser&gt;</span>
<span class="w">    </span>
<span class="w">    </span>[...]
<span class="w">    </span>
<span class="w">    </span>#<span class="w"> </span>reporting<span class="w"> </span>points
<span class="w">    </span><span class="nt">&lt;textvar</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;Gauges&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;102.32 18.62 102.82 19.30 102.67 18.12&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span>
<span class="w">    </span>#<span class="w"> </span>time-related<span class="w"> </span>variables
<span class="w">    </span><span class="nt">&lt;textvar</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;CalendarDayStart&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;02/01/1979 00:00&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;textvar</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;StepStart&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;02/01/1990 00:00&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;textvar</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;StepEnd&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;01/01/2000 00:00&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;textvar</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;timestepInit&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;01/01/1990 00:00&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;textvar</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;ReportSteps&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;1..99999&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span>
<span class="w">    </span>#<span class="w"> </span>paths
<span class="w">    </span><span class="nt">&lt;textvar</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;PathInit&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;$(PathRoot)/results/initial&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;textvar</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;PathWarm&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;$(PathRoot)/results/warmup&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;textvar</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;PathOut&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;$(PathRoot)/results/run&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span>
<span class="w">    </span>#<span class="w"> </span>initial<span class="w"> </span>conditions
<span class="w">    </span><span class="nt">&lt;textvar</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;OFDirectInitValue&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;$(PathWarm)/ofdir_end.nc&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;textvar</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;OFOtherInitValue&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;$(PathWarm)/ofoth_end.nc&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span>[...]
<span class="w">    </span><span class="nt">&lt;textvar</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;LZInitValue&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;$(PathWarm)/lz&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;textvar</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;ReservoirInitialFillValue&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;$(PathWarm)/rsfil_end.nc&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span>
<span class="w">    </span>[...]

<span class="nt">&lt;/lfuser&gt;</span>

<span class="nt">&lt;lfbinding&gt;</span>
<span class="w">    </span>
<span class="w">    </span>[...]
<span class="w">    </span>
<span class="w">    </span>#<span class="w"> </span>initialization
<span class="w">    </span><span class="nt">&lt;textvar</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;LZAvInflowMap&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;$(PathInit)/lzavin&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;textvar</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;AvgDis&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;$(PathInit)/avgdis&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span>
<span class="w">    </span>[...]
<span class="w">    </span>
<span class="nt">&lt;/lfbinding&gt;</span>
</pre></div>
</div>
<p>In the <code class="docutils literal notranslate"><span class="pre">&lt;lfoptions&gt;</span></code> section, we activate/deactivate the time series and maps to be reported. We chose to report time series of discharge (<code class="docutils literal notranslate"><span class="pre">repDischargeTs</span></code>) and reservoirs (<code class="docutils literal notranslate"><span class="pre">repsimulateReservoirs</span></code>); these options will save text files (in TSS format) with the respective time series. Regarding maps, in this case we’re not interested in the end state maps, therefore <code class="docutils literal notranslate"><span class="pre">repEndMaps</span></code> is deactivated. We’re only interested in the map stacks of state variables, therefore we activated <code class="docutils literal notranslate"><span class="pre">RepStateMaps</span></code>. However, this option will not create the discharge and water abstraction map stacks; for that we need to activate the variables <code class="docutils literal notranslate"><span class="pre">repDischargeMaps</span></code> and <code class="docutils literal notranslate"><span class="pre">RepTotalAbs</span></code>. Finally, to generate the water exploitation index maps, we need to activate both <code class="docutils literal notranslate"><span class="pre">indicator</span></code> and <code class="docutils literal notranslate"><span class="pre">repWIndex</span></code>.</p>
<p>In the <code class="docutils literal notranslate"><span class="pre">&lt;lfuser&gt;</span></code> section, we need to set several features. First, the points in the river network for which time series output will be generated; we define three points using their longitude and latitude separated by spaces (there are other posibilities to set the reporting points). We set the simulation period, i.e., the start and end dates (<code class="docutils literal notranslate"><span class="pre">StepStart</span></code> and <code class="docutils literal notranslate"><span class="pre">StepEnd</span></code>), the timestep from which initial conditions may be read (<code class="docutils literal notranslate"><span class="pre">timestepInit</span></code>) and the timesteps that will be included in the output map stacks (<code class="docutils literal notranslate"><span class="pre">ReportSteps</span></code>). Later, the paths for the initial conditions and outputs are set. Finaly, the location of the initial condition maps must be specified. Special remark on the lower groundwater zone initial value (<code class="docutils literal notranslate"><span class="pre">LZInitValue</span></code>), for which we generated a map stack during the <a class="reference internal" href="2_warmup.html"><span class="std std-doc">warmup run</span></a>, instead of an end map; that’s the reason why the directory where the map is located is different.</p>
<blockquote>
<div><p><strong>Note</strong>. Pay special attention to the 5 nines in the variable <code class="docutils literal notranslate"><span class="pre">ReportSteps</span></code> (<code class="docutils literal notranslate"><span class="pre">1..99999</span></code>), which are necessary since the simulation exceeds the 10,000 timesteps</p>
</div></blockquote>
<p>In the <code class="docutils literal notranslate"><span class="pre">&lt;lfbinding&gt;</span></code> element, same as in the warmup run, we must define the two maps that we generated in the <a class="reference internal" href="1_initialization.html"><span class="std std-doc">initialization run</span></a>.</p>
</section>
<section id="run-the-simulation">
<h2>2 Run the simulation<a class="headerlink" href="#run-the-simulation" title="Link to this heading">#</a></h2>
<p>This step is similar to the two previous runs, but pointing at the specific settings file (<a class="reference download internal" download="" href="_downloads/9ded7408cfabd4e787074a8ce4460b34/settings_run.xml"><span class="xref download myst"><code class="docutils literal notranslate"><span class="pre">settings_run.xml</span></code></span></a>).</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>conda<span class="w"> </span>activate<span class="w"> </span>your_lisflood_environment
<span class="nb">cd</span><span class="w"> </span>&lt;path_where_you_saved_the_repository&gt;/lisflood-usecases
lisflood<span class="w"> </span>LF_mekong_usecase/settings_run.xml
</pre></div>
</div>
</section>
<section id="outputs">
<h2>3 Outputs<a class="headerlink" href="#outputs" title="Link to this heading">#</a></h2>
<p>In this section we will see some of the outputs that the simulation has generated, which include map stacks and time series.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">settings_file</span> <span class="o">=</span> <span class="n">path_model</span> <span class="o">/</span> <span class="s1">&#39;settings_run.xml&#39;</span>
</pre></div>
</div>
</div>
</div>
<section id="map-stacks">
<h3>3.1 Map stacks<a class="headerlink" href="#map-stacks" title="Link to this heading">#</a></h3>
<section id="soil-layers">
<h4>3.1.1 Soil layers<a class="headerlink" href="#soil-layers" title="Link to this heading">#</a></h4>
<p>First, we will analyse the water stored in the soil layers. We’ll load the data and then plot it. The maps show the average over time, whereas the lineplot shows the time series obtained by computing the spatial average for each timestep. In the first case we get an insight into the spatial variability, whereas in the second case into the temporal variability.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># load and plot some map stacks</span>
<span class="n">soil_storages</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;tha&#39;</span><span class="p">,</span> <span class="s1">&#39;thb&#39;</span><span class="p">,</span> <span class="s1">&#39;thc&#39;</span><span class="p">]:</span>
    <span class="n">da</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataarray</span><span class="p">(</span><span class="n">path_run</span> <span class="o">/</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">.nc&#39;</span><span class="p">)</span>
    <span class="n">da</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">soil_storages</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="n">da</span>

<span class="c1"># calculate minimum and maximum values of soil moisture among all the map stacks</span>
<span class="n">vmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">da</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="k">for</span> <span class="n">var</span><span class="p">,</span> <span class="n">da</span> <span class="ow">in</span> <span class="n">soil_storages</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
<span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">da</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="k">for</span> <span class="n">var</span><span class="p">,</span> <span class="n">da</span> <span class="ow">in</span> <span class="n">soil_storages</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
<span class="n">plot_mapstacks</span><span class="p">(</span><span class="n">soil_storages</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;soil moisture&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ValueError</span><span class="g g-Whitespace">                                </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">line</span> <span class="mi">4</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">soil_storages</span> <span class="o">=</span> <span class="p">{}</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;tha&#39;</span><span class="p">,</span> <span class="s1">&#39;thb&#39;</span><span class="p">,</span> <span class="s1">&#39;thc&#39;</span><span class="p">]:</span>
<span class="ne">----&gt; </span><span class="mi">4</span>     <span class="n">da</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataarray</span><span class="p">(</span><span class="n">path_run</span> <span class="o">/</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">.nc&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span>     <span class="n">da</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span>     <span class="n">soil_storages</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="n">da</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/xarray/backends/api.py:881,</span> in <span class="ni">open_dataarray</span><span class="nt">(filename_or_obj, engine, chunks, cache, decode_cf, mask_and_scale, decode_times, decode_timedelta, use_cftime, concat_characters, decode_coords, drop_variables, inline_array, chunked_array_type, from_array_kwargs, backend_kwargs, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">710</span> <span class="k">def</span><span class="w"> </span><span class="nf">open_dataarray</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">711</span>     <span class="n">filename_or_obj</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="n">ReadBuffer</span> <span class="o">|</span> <span class="n">AbstractDataStore</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">712</span>     <span class="o">*</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>    <span class="mi">731</span>     <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">732</span> <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataArray</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">733</span><span class="w">     </span><span class="sd">&quot;&quot;&quot;Open an DataArray from a file or file-like object containing a single</span>
<span class="g g-Whitespace">    </span><span class="mi">734</span><span class="sd">     data variable.</span>
<span class="g g-Whitespace">    </span><span class="mi">735</span><span class="sd"> </span>
<span class="sd">   (...)    878     open_dataset</span>
<span class="g g-Whitespace">    </span><span class="mi">879</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">881</span>     <span class="n">dataset</span> <span class="o">=</span> <span class="n">open_dataset</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">882</span>         <span class="n">filename_or_obj</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">883</span>         <span class="n">decode_cf</span><span class="o">=</span><span class="n">decode_cf</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">884</span>         <span class="n">mask_and_scale</span><span class="o">=</span><span class="n">mask_and_scale</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">885</span>         <span class="n">decode_times</span><span class="o">=</span><span class="n">decode_times</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">886</span>         <span class="n">concat_characters</span><span class="o">=</span><span class="n">concat_characters</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">887</span>         <span class="n">decode_coords</span><span class="o">=</span><span class="n">decode_coords</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">888</span>         <span class="n">engine</span><span class="o">=</span><span class="n">engine</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">889</span>         <span class="n">chunks</span><span class="o">=</span><span class="n">chunks</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">890</span>         <span class="n">cache</span><span class="o">=</span><span class="n">cache</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">891</span>         <span class="n">drop_variables</span><span class="o">=</span><span class="n">drop_variables</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">892</span>         <span class="n">inline_array</span><span class="o">=</span><span class="n">inline_array</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">893</span>         <span class="n">chunked_array_type</span><span class="o">=</span><span class="n">chunked_array_type</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">894</span>         <span class="n">from_array_kwargs</span><span class="o">=</span><span class="n">from_array_kwargs</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">895</span>         <span class="n">backend_kwargs</span><span class="o">=</span><span class="n">backend_kwargs</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">896</span>         <span class="n">use_cftime</span><span class="o">=</span><span class="n">use_cftime</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">897</span>         <span class="n">decode_timedelta</span><span class="o">=</span><span class="n">decode_timedelta</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">898</span>         <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">899</span>     <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">901</span>     <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">data_vars</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">902</span>         <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">data_vars</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/xarray/backends/api.py:668,</span> in <span class="ni">open_dataset</span><span class="nt">(filename_or_obj, engine, chunks, cache, decode_cf, mask_and_scale, decode_times, decode_timedelta, use_cftime, concat_characters, decode_coords, drop_variables, inline_array, chunked_array_type, from_array_kwargs, backend_kwargs, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">665</span>     <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">backend_kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">667</span> <span class="k">if</span> <span class="n">engine</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">668</span>     <span class="n">engine</span> <span class="o">=</span> <span class="n">plugins</span><span class="o">.</span><span class="n">guess_engine</span><span class="p">(</span><span class="n">filename_or_obj</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">670</span> <span class="k">if</span> <span class="n">from_array_kwargs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">671</span>     <span class="n">from_array_kwargs</span> <span class="o">=</span> <span class="p">{}</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/xarray/backends/plugins.py:194,</span> in <span class="ni">guess_engine</span><span class="nt">(store_spec)</span>
<span class="g g-Whitespace">    </span><span class="mi">186</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">187</span>     <span class="n">error_msg</span> <span class="o">=</span> <span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">188</span>         <span class="s2">&quot;found the following matches with the input file in xarray&#39;s IO &quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">189</span>         <span class="sa">f</span><span class="s2">&quot;backends: </span><span class="si">{</span><span class="n">compatible_engines</span><span class="si">}</span><span class="s2">. But their dependencies may not be installed, see:</span><span class="se">\n</span><span class="s2">&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">190</span>         <span class="s2">&quot;https://docs.xarray.dev/en/stable/user-guide/io.html </span><span class="se">\n</span><span class="s2">&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">191</span>         <span class="s2">&quot;https://docs.xarray.dev/en/stable/getting-started-guide/installing.html&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">192</span>     <span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">194</span> <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>

<span class="ne">ValueError</span>: did not find a match in any of xarray&#39;s currently installed IO backends [&#39;netcdf4&#39;]. Consider explicitly selecting one of the installed engines via the ``engine`` parameter, or installing additional IO dependencies, see:
<span class="ne">https</span>://docs.xarray.dev/en/stable/getting-started-guide/installing.html
<span class="ne">https</span>://docs.xarray.dev/en/stable/user-guide/io.html
</pre></div>
</div>
</div>
</div>
<p><em><strong>Figure 1</strong>. Evolution of soil moisture in the three soil layers throughout the main run.</em></p>
<p>From the previous plots we can extract the following thoughts:</p>
<ul class="simple">
<li><p>The superficial soil (<span class="math notranslate nohighlight">\(th_a\)</span>) shows a much higher temporal variability, since this layer is the most affected by precipitation and evapotranspiration.</p></li>
<li><p>The upper soil layer (<span class="math notranslate nohighlight">\(th_b\)</span>) has a seasonal variation. The “wet” season shows a lag with respect to the “wet” season in the superficial soil.</p></li>
<li><p>The lower soil layer (<span class="math notranslate nohighlight">\(th_c\)</span>) has also a seasonal variation, but at a much lower scale than the other two soil layers, reason why it’s bearly noticeable in this plot.</p></li>
</ul>
</section>
<section id="groundwater-zones">
<h4>3.1.2 Groundwater zones<a class="headerlink" href="#groundwater-zones" title="Link to this heading">#</a></h4>
<p>Let’s do a similar analysis on the two groundwater zones.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># load and plot some map stacks</span>
<span class="n">gw</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;uz&#39;</span><span class="p">,</span> <span class="s1">&#39;lz&#39;</span><span class="p">]:</span>
    <span class="n">da</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataarray</span><span class="p">(</span><span class="n">path_run</span> <span class="o">/</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">.nc&#39;</span><span class="p">)</span>
    <span class="n">da</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">gw</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="n">da</span>

<span class="c1"># calculate minimum and maximum values among all the map stacks</span>
<span class="n">vmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">da</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="k">for</span> <span class="n">var</span><span class="p">,</span> <span class="n">da</span> <span class="ow">in</span> <span class="n">gw</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
<span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">da</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="k">for</span> <span class="n">var</span><span class="p">,</span> <span class="n">da</span> <span class="ow">in</span> <span class="n">gw</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
<span class="n">plot_mapstacks</span><span class="p">(</span><span class="n">gw</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;water content&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/e424fff3c86d8704fb791bc6a07465ece515575de5fb9ebdb8c26d95be65fd20.png" src="_images/e424fff3c86d8704fb791bc6a07465ece515575de5fb9ebdb8c26d95be65fd20.png" />
</div>
</div>
<p><em><strong>Figure 2</strong>. Evolution of the two groundwater storages trhoughout the main run.</em></p>
<p>From this plot we can infer that, in this case, both zones show seasonality, but the order of magnitude of this seasonal variation differs. Whereas the annual pattern in the upper zone (<span class="math notranslate nohighlight">\(\text{uz}\)</span>) is clearly visible in the lineplot, that of the lower zone (<span class="math notranslate nohighlight">\(\text{lz}\)</span>) is unnoticeable.</p>
</section>
<section id="discharge">
<h4>3.1.3 Discharge<a class="headerlink" href="#discharge" title="Link to this heading">#</a></h4>
<p>In the case of discharge, apart from the average map over time, we will plot the discharge time series for the outlet.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># read map stack of daily discharge</span>
<span class="n">dis</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataarray</span><span class="p">(</span><span class="n">path_run</span> <span class="o">/</span> <span class="s1">&#39;dis.nc&#39;</span><span class="p">)</span>

<span class="c1"># extract time series at the outlet</span>
<span class="n">outlet</span> <span class="o">=</span> <span class="n">dis</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">argmax</span><span class="p">([</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">])</span>
<span class="n">dis_outlet</span> <span class="o">=</span> <span class="n">dis</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">outlet</span><span class="p">)</span>

<span class="c1"># configure plot</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">gs</span> <span class="o">=</span> <span class="n">GridSpec</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figure</span><span class="o">=</span><span class="n">fig</span><span class="p">)</span>

<span class="c1"># map of daily mean</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">dis</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span> 
    <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span>
    <span class="n">cbar_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;orientation&quot;</span><span class="p">:</span> <span class="s2">&quot;horizontal&quot;</span><span class="p">,</span> <span class="s2">&quot;shrink&quot;</span><span class="p">:</span> <span class="mf">0.8</span><span class="p">,</span> <span class="s2">&quot;aspect&quot;</span><span class="p">:</span> <span class="mi">40</span><span class="p">,</span> <span class="s2">&quot;pad&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">}</span>
<span class="p">)</span>

<span class="c1"># daily timeseries of areal mean</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">:])</span>
<span class="n">outlet</span> <span class="o">=</span> <span class="n">dis</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">argmax</span><span class="p">([</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">])</span>
<span class="n">dis_outlet</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">)</span>
<span class="c1"># configure timeseries plot</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
    <span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="n">dis</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dis</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;discharge [</span><span class="si">{</span><span class="n">dis</span><span class="o">.</span><span class="n">units</span><span class="si">}</span><span class="s1">]&#39;</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/5979aff4369cf7f675f95c111729f271376d4d6fe3663ba8a48640a710fdb816.png" src="_images/5979aff4369cf7f675f95c111729f271376d4d6fe3663ba8a48640a710fdb816.png" />
</div>
</div>
<p><em><strong>Figure 3</strong>. Average river discharge and time series of river discharge at the catchment outlet.</em></p>
<p>The same discharge time series at the catchment outlet can be generated directly from the model simulation. For that, the option <code class="docutils literal notranslate"><span class="pre">repDischargeTs</span></code> in the settings file must be active, and the variable <code class="docutils literal notranslate"><span class="pre">Gauges</span></code> must include the coordinates of the outlet.</p>
</section>
<section id="reservoir-and-rice-irrigation">
<h4>3.1.4 Reservoir and rice irrigation<a class="headerlink" href="#reservoir-and-rice-irrigation" title="Link to this heading">#</a></h4>
<p>In this section we will analyse the map stacks generated by the reservoir and the rice irrigation options. First, we will load the map stacks and later we will plot the data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># load map stacks</span>
<span class="n">water_use</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ResStor&#39;</span><span class="p">,</span> <span class="s1">&#39;ResAbs&#39;</span><span class="p">,</span> <span class="s1">&#39;tAbsPdRc&#39;</span><span class="p">]:</span>
    <span class="n">da</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataarray</span><span class="p">(</span><span class="n">path_run</span> <span class="o">/</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">.nc&#39;</span><span class="p">)</span>
    <span class="n">da</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">water_use</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="n">da</span>

<span class="n">plot_mapstacks</span><span class="p">(</span><span class="n">water_use</span><span class="p">,</span> <span class="n">agg</span><span class="o">=</span><span class="s1">&#39;sum&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;volume&#39;</span><span class="p">,</span> <span class="n">yscale</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/ce69afebfca2d40208d7803934555739b1b3c425c86774423c6e932f9809b7a5.png" src="_images/ce69afebfca2d40208d7803934555739b1b3c425c86774423c6e932f9809b7a5.png" />
</div>
</div>
<p><em><strong>Figure 4</strong>. Evolution of the reservoir volumen over the main run.</em></p>
<p>The two maps on the top left show, respectively, mean reservoir storage and mean reservoir abstraction. Since there is only one reservoir in the catchment, only one cell has a value larger than zero. We can use this map to find the location of the reservoir and extract from the map stack the time series of reservoir storage for that cell (blue line in the lineplot). A similar procedure is carried out for the map stack of reservoir abstraction to produce the green line in the lineplot.</p>
<p>Finally, the paddy rice irrigation map (plot on the top right) shows the areas in the catchment where rice is produced and the average amount of water required. The map stack of rice abstraction is used to create a total rice irrigation demand (red line in the lineplot). Pay attention to the scale of the <span class="math notranslate nohighlight">\(y\)</span> axis in the lineplot; it is in logarithmic scale in order to show the variability of abstraction and rice irrigation despite their much lower order of magnitude compared with the reservoir storage.</p>
<p>As shown in these plots, from the map stacks we can extract time series. As we will see later, activating the option <code class="docutils literal notranslate"><span class="pre">repsimulateReservoir</span></code> in the settings file generates time series (TSS files) of the reservoir simulation. However, in the case of the reservoir storage, the TSS file represents relative filling, instead of stored volume.</p>
</section>
<section id="water-exploitation-indexes">
<h4>3.1.5 Water exploitation indexes<a class="headerlink" href="#water-exploitation-indexes" title="Link to this heading">#</a></h4>
<p>As we activated the options <code class="docutils literal notranslate"><span class="pre">indicator</span></code> and <code class="docutils literal notranslate"><span class="pre">repWIndex</span></code>, a series of water index maps were generated:</p>
<ul class="simple">
<li><p>WDI: water dependency index</p></li>
</ul>
<div class="math notranslate nohighlight">
\[WDI = \frac{\text{local Water Demand Not Met By Local Water}}{\text{total Water Demand}}\]</div>
<ul class="simple">
<li><p>WSI: water security index</p></li>
</ul>
<div class="math notranslate nohighlight">
\[WSI = \frac{\text{upstream Inflow Actually Used}}{\text{upstream Inflow Available}}\]</div>
<ul class="simple">
<li><p>WTI: water sustainability index</p></li>
</ul>
<div class="math notranslate nohighlight">
\[WTI = 1 - \frac{\text{surface Water Deficit}}{\text{total Water Demand}}\]</div>
<p>All these maps have monthly resolution, even though the simulation has daily timesteps.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># load and plot some map stacks</span>
<span class="n">wi</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;WDI&#39;</span><span class="p">,</span> <span class="s1">&#39;WSI&#39;</span><span class="p">,</span> <span class="s1">&#39;WTI&#39;</span><span class="p">]:</span>
    <span class="n">da</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataarray</span><span class="p">(</span><span class="n">path_run</span> <span class="o">/</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">.nc&#39;</span><span class="p">)</span>
    <span class="n">da</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">wi</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="n">da</span>

<span class="c1"># calculate minimum and maximum values among all the map stacks</span>
<span class="n">vmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">da</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="k">for</span> <span class="n">var</span><span class="p">,</span> <span class="n">da</span> <span class="ow">in</span> <span class="n">wi</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
<span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">da</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="k">for</span> <span class="n">var</span><span class="p">,</span> <span class="n">da</span> <span class="ow">in</span> <span class="n">wi</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
<span class="n">plot_mapstacks</span><span class="p">(</span><span class="n">wi</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;water content&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/e9f08e956a14d3d8c1f3fa8b7fe4355296ecb86765d1d50bd1ee26f9ae7e8ebd.png" src="_images/e9f08e956a14d3d8c1f3fa8b7fe4355296ecb86765d1d50bd1ee26f9ae7e8ebd.png" />
</div>
</div>
<p><em><strong>Figure 5</strong>. Water indexes. Maps are averages over the whole period; time series are averages over the whole catchment.</em></p>
<p>The maps reproduce the water regions; with the southern region having a slightly higher water demand stress. In the time series we observe that from 2005 onwards there are recurrent periods in which some of the local demands are not met by local water (peaks in WDI).</p>
</section>
</section>
<section id="time-series">
<h3>3.2 Time series<a class="headerlink" href="#time-series" title="Link to this heading">#</a></h3>
<section id="id1">
<h4>3.2.1 Discharge<a class="headerlink" href="#id1" title="Link to this heading">#</a></h4>
<p>As mentioned before, discharge time series can be produced directly from the model. The option <code class="docutils literal notranslate"><span class="pre">repDischargeTs</span></code> in the settings file must be active, and the variable <code class="docutils literal notranslate"><span class="pre">Gauges</span></code> must define the points of interest (in our case using the coordinates, but there are other ways to set it). We defined three points in which the model will generate time series. Let’s check the results:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import time series</span>
<span class="n">disWin</span> <span class="o">=</span> <span class="n">read_tss</span><span class="p">(</span><span class="n">path_run</span> <span class="o">/</span> <span class="s1">&#39;disWin.tss&#39;</span><span class="p">,</span> <span class="n">xml</span><span class="o">=</span><span class="n">settings_file</span><span class="p">)</span>

<span class="c1"># plot time series</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">disWin</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">.7</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">disWin</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">dis_outlet</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> 
    <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> 
    <span class="n">markersize</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> 
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> 
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> 
    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;3 (netCDF)&#39;</span>
<span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
    <span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="n">disWin</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">disWin</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span>
    <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">200</span><span class="p">,</span> <span class="mi">6200</span><span class="p">),</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;discharge [m3/s]&#39;</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
<span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.15</span><span class="p">,</span> <span class="mf">.1</span><span class="p">,</span> <span class="mf">.1</span><span class="p">],</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/c6defe0505f6fbeb3a8ab100e4ec00e8b80ca91ab1ba234fe3521095370740b6.png" src="_images/c6defe0505f6fbeb3a8ab100e4ec00e8b80ca91ab1ba234fe3521095370740b6.png" />
</div>
</div>
<p><em><strong>Figure 6</strong>. Discharge time series at the three points of interest.</em></p>
<p>The <code class="docutils literal notranslate"><span class="pre">disWin.tss</span></code> file includes the discharge time series for the three points we defined. Each point is assigned an identifier; in our case, the catchment outlet corresponds to point 3. For the sake of comparison, the plot includes as points the discharge time series at the outlet extracted from the discharge map stack (<code class="docutils literal notranslate"><span class="pre">dis.nc</span></code>) in section Discharge; the values of the TSS file are equal to those of the netCDF.</p>
</section>
<section id="reservoirs">
<h4>3.2.2 Reservoirs<a class="headerlink" href="#reservoirs" title="Link to this heading">#</a></h4>
<p>We have activated the option <code class="docutils literal notranslate"><span class="pre">repsimulateReservoirs</span></code> in the settings file, so the simulation has created three TSS files representing the inflow (<code class="docutils literal notranslate"><span class="pre">qresin.tss</span></code>), outflow (<code class="docutils literal notranslate"><span class="pre">qresout.tss</span></code>) and relative filling (<code class="docutils literal notranslate"><span class="pre">resfill.tss</span></code>) of the reservoirs. In our case, since there’s only one reservoir in the catchment, only one time series is included in each of these TSS files. Let’s load these time series and plot the reservoir simulation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># load reservoir time series</span>
<span class="n">timeseries</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;inflow&#39;</span><span class="p">:</span> <span class="s1">&#39;qresin&#39;</span><span class="p">,</span>
    <span class="s1">&#39;outflow&#39;</span><span class="p">:</span> <span class="s1">&#39;qresout&#39;</span><span class="p">,</span>
    <span class="s1">&#39;filling&#39;</span><span class="p">:</span> <span class="s1">&#39;resfill&#39;</span>
<span class="p">}</span>
<span class="n">res_ts</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">var</span><span class="p">,</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">timeseries</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">ts</span> <span class="o">=</span> <span class="n">read_tss</span><span class="p">(</span><span class="n">path_run</span> <span class="o">/</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s1">.tss&#39;</span><span class="p">,</span> <span class="n">xml</span><span class="o">=</span><span class="n">settings_file</span><span class="p">,</span> <span class="n">squeeze</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">res_ts</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="n">ts</span>
<span class="n">res_ts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">res_ts</span><span class="p">)</span>

<span class="c1"># load reservoir relative filling limits</span>
<span class="n">limits</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;conservative&#39;</span><span class="p">:</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span>
    <span class="s1">&#39;normal&#39;</span><span class="p">:</span> <span class="s1">&#39;n&#39;</span><span class="p">,</span>
    <span class="s1">&#39;flood&#39;</span><span class="p">:</span> <span class="s1">&#39;f&#39;</span>
<span class="p">}</span>
<span class="n">res_lim</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">var</span><span class="p">,</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">limits</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">res_lim</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
        <span class="n">path_model</span> <span class="o">/</span> <span class="s1">&#39;tables&#39;</span> <span class="o">/</span> <span class="s1">&#39;reservoirs&#39;</span> <span class="o">/</span> <span class="sa">f</span><span class="s1">&#39;r</span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s1">lim.txt&#39;</span><span class="p">,</span> 
        <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;\s+&#39;</span><span class="p">,</span> 
        <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
        <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span>
    <span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># plot reservoir simulation</span>
<span class="n">plot_reservoir</span><span class="p">(</span>
    <span class="n">res_ts</span><span class="p">,</span> 
    <span class="n">clim</span><span class="o">=</span><span class="n">res_lim</span><span class="p">[</span><span class="s1">&#39;conservative&#39;</span><span class="p">],</span> 
    <span class="n">nlim</span><span class="o">=</span><span class="n">res_lim</span><span class="p">[</span><span class="s1">&#39;normal&#39;</span><span class="p">],</span>
    <span class="n">flim</span><span class="o">=</span><span class="n">res_lim</span><span class="p">[</span><span class="s1">&#39;flood&#39;</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/94445ef3e24c2e51e9be0283f3452ea5385ffd5fd93d990a982cb44783d6e9c1.png" src="_images/94445ef3e24c2e51e9be0283f3452ea5385ffd5fd93d990a982cb44783d6e9c1.png" />
</div>
</div>
<p><em><strong>Figure 7</strong>. Reservoir inflow, outflow and relative filling.</em></p>
<p>Conclusions from this plot:</p>
<ul class="simple">
<li><p>The reservoir storage is kept between the normal and flood limits throughout most of the simulation period. In 1994, 1995 and 1997 there are three exceptions in which the storage exceeded the flood limit.</p></li>
</ul>
</section>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="2_warmup.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Warmup run</p>
      </div>
    </a>
    <a class="right-next"
       href="4_calibration.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Calibration</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#settings-file">1 Settings file</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#run-the-simulation">2 Run the simulation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#outputs">3 Outputs</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#map-stacks">3.1 Map stacks</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#soil-layers">3.1.1 Soil layers</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#groundwater-zones">3.1.2 Groundwater zones</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#discharge">3.1.3 Discharge</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#reservoir-and-rice-irrigation">3.1.4 Reservoir and rice irrigation</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#water-exploitation-indexes">3.1.5 Water exploitation indexes</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#time-series">3.2 Time series</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">3.2.1 Discharge</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#reservoirs">3.2.2 Reservoirs</a></li>
</ul>
</li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Joint Research Center - European Commission
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>