
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Input and general settings &#8212; LISFLOOD use cases</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = '0_general_setup';</script>
    <link rel="canonical" href="/lisflood-usecases/0_general_setup.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Initialization run" href="1_initialization.html" />
    <link rel="prev" title="A LISFLOOD use case: the Nam Ngum River Basin" href="README.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="README.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/header.png" class="logo__image only-light" alt="LISFLOOD use cases - Home"/>
    <script>document.write(`<img src="_static/header.png" class="logo__image only-dark" alt="LISFLOOD use cases - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Input and general settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="1_initialization.html">Initialization run</a></li>
<li class="toctree-l1"><a class="reference internal" href="2_warmup.html">Warmup run</a></li>
<li class="toctree-l1"><a class="reference internal" href="3_run.html">Main run</a></li>
<li class="toctree-l1"><a class="reference internal" href="4_calibration.html">Calibration</a></li>
<li class="toctree-l1"><a class="reference internal" href="5_other_usecases.html">Other use cases</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/0_general_setup.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Input and general settings</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#study-area">1 Study area</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#input-data">2 Input data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#maps">2.1 Maps</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#static-maps">2.1.1 Static maps</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#dynamic-maps">2.1.2 Dynamic maps</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#meteorological-forcings">2.2 Meteorological forcings</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tables">2.3 Tables</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#general-setup">3 General setup</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#runs">3.1 Runs</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#general-settings">3.2 General settings</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#model-options">3.2.1 Model options</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#calibration-parameters">3.2.2 Calibration parameters</a></li>
</ul>
</li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <p><img alt="header" src="_images/header.png" /></p>
<section class="tex2jax_ignore mathjax_ignore" id="input-and-general-settings">
<h1>Input and general settings<a class="headerlink" href="#input-and-general-settings" title="Link to this heading">#</a></h1>
<!-- [![Binder](https://mybinder.org/badge_logo.svg)](https://mybinder.org/v2/gh/casadoj/mekong_usecase/main?urlpath=%2Fdoc%2Ftree%2Fdocs%2F0_general_setup.ipynb) --!>

<br>
<br>
<br>

The objective of this use case is to present new users the steps necessary to develop a LISFLOOD catchment model. It will guide you through the input data, the most important parts of the settings file, the diverse runs you will need to initialize the model states, and the outputs of every run.

We will suppose that there is a project in which we are asked to run a 30-year long simulation of the Nam Ngum river (Laos) to assess the water resources in the catchment.<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">xarray</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xr</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">lisflood_read_plot</span><span class="w"> </span><span class="kn">import</span> <span class="n">plot_map_timeseries</span><span class="p">,</span> <span class="n">plot_mapstacks</span>

<span class="n">path_model</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;../LF_mekong_usecase&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="study-area">
<h2>1 Study area<a class="headerlink" href="#study-area" title="Link to this heading">#</a></h2>
<p>The Nam Ngum River is a tributary of the Mekong River that flows into it a few kilometers downstream of Laos’ capital city, Vientiane. The catchment has an area of approximately 16,000 km², of which 8,400 km² are regulated by the Nam Ngum Reservoir. The mean annual rainfall in the catchment is 1200 mm and a mean annual temperature around 12 °C.</p>
<p>The <a class="reference external" href="https://global-flood.emergency.copernicus.eu/">GloFAS (Global Flood Awareness System)</a> streamflow dataset contains two gauging stations within the Nam Ngum River catchment. In this exercise, we will use the gauge downstream to cut the static maps and the meteorological forcing that LISFLOOD needs as input data. However, we are not interested specifically in these two gauging stations; instead, we will define three reporting points, one corresponding to the downstream gauge and two points we will locate in the tributaries of the Nam Ngum River.</p>
<p><img alt="Run explanation" src="_images/introduction_map.png" /></p>
<p><em><strong>Figure 1</strong>. The Nam Ngum river (Laos) is a tributary of the Mekong river.</em></p>
</section>
<section id="input-data">
<h2>2 Input data<a class="headerlink" href="#input-data" title="Link to this heading">#</a></h2>
<p>The input data required by the LISFLOOD model can be divided in three groups: static maps, tables and meteorological forcings.</p>
<section id="maps">
<h3>2.1 Maps<a class="headerlink" href="#maps" title="Link to this heading">#</a></h3>
<p>They are included in the folder <code class="docutils literal notranslate"><span class="pre">maps</span></code>, classified according to topics (<code class="docutils literal notranslate"><span class="pre">channels</span></code>, <code class="docutils literal notranslate"><span class="pre">general</span></code>, <code class="docutils literal notranslate"><span class="pre">lakes</span></code>…). This organization is voluntary, you can find your own way to organize the maps, as long as you reference them correctly in the settings file.</p>
<p>The specific maps for this case study were created by cutting the global maps to the catchment of our oulet gauging station. The <code class="docutils literal notranslate"><span class="pre">cutmaps</span></code> tool from the <a class="reference external" href="https://github.com/ec-jrc/lisflood-utilities">LISFLOOD utilities repository</a> allows you to perform this task.</p>
<p>LISFLOOD requires a set of maps that define catchment properties such as topography, soil properties, land use, etc. LISFLOOD users are encouraged to produce their own maps following the protocol explained <a class="reference external" href="https://ec-jrc.github.io/lisflood-code/4_Static-Maps-introduction/">here</a>. <a class="reference external" href="https://data.jrc.ec.europa.eu/dataset/f572c443-7466-4adf-87aa-c0847a169f23">European maps</a> at 1 arcminute resolution and <a class="reference external" href="https://publications.jrc.ec.europa.eu/repository/handle/JRC132801">global maps</a> at 3 arcminute resolution are publicly available.</p>
<section id="static-maps">
<h4>2.1.1 Static maps<a class="headerlink" href="#static-maps" title="Link to this heading">#</a></h4>
<p>The vast majority of these maps are static, i.e., they do not change over time. These maps include the channel properties, land cover maps, soil properties, etc. Let’s see how some of the soil properties look like:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># load maps:</span>
<span class="c1">#     &quot;ksat&quot; is the saturated hydraulic conductivity of the soil</span>
<span class="c1">#     &quot;thetas&quot; is the volumetric water content of the saturated soil</span>
<span class="c1">#     &quot;1&quot; and &quot;2&quot; refer to the soil layer</span>
<span class="c1">#     &quot;f&quot; refers to the fraction of soil covered by forests</span>
<span class="n">variables</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ksat1_f&#39;</span><span class="p">,</span> <span class="s1">&#39;ksat2_f&#39;</span><span class="p">,</span> <span class="s1">&#39;thetas1_f&#39;</span><span class="p">,</span> <span class="s1">&#39;thetas2_f&#39;</span><span class="p">,</span> <span class="s1">&#39;thetas3&#39;</span><span class="p">]</span>
<span class="n">soils</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">variables</span><span class="p">:</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">path_model</span> <span class="o">/</span> <span class="s1">&#39;maps&#39;</span> <span class="o">/</span> <span class="s1">&#39;soil_hydraulics&#39;</span> <span class="o">/</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">.nc&#39;</span><span class="p">)</span>
    <span class="n">ds</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">soils</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;Band1&#39;</span><span class="p">]</span>

<span class="c1"># plot maps</span>
<span class="n">ncols</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">variables</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="n">ncols</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span> <span class="o">*</span> <span class="n">ncols</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">da</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">soils</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
    <span class="n">da</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> 
        <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> 
        <span class="n">cbar_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="n">var</span><span class="p">,</span> <span class="s2">&quot;orientation&quot;</span><span class="p">:</span> <span class="s2">&quot;horizontal&quot;</span><span class="p">,</span> <span class="s2">&quot;shrink&quot;</span><span class="p">:</span> <span class="mf">0.8</span><span class="p">,</span> <span class="s2">&quot;aspect&quot;</span><span class="p">:</span> <span class="mi">40</span><span class="p">,</span> <span class="s2">&quot;pad&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">}</span>
    <span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ValueError</span><span class="g g-Whitespace">                                </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">line</span> <span class="mi">9</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> <span class="n">soils</span> <span class="o">=</span> <span class="p">{}</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">variables</span><span class="p">:</span>
<span class="ne">----&gt; </span><span class="mi">9</span>     <span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">path_model</span> <span class="o">/</span> <span class="s1">&#39;maps&#39;</span> <span class="o">/</span> <span class="s1">&#39;soil_hydraulics&#39;</span> <span class="o">/</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">.nc&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span>     <span class="n">ds</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span>     <span class="n">soils</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;Band1&#39;</span><span class="p">]</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/xarray/backends/api.py:668,</span> in <span class="ni">open_dataset</span><span class="nt">(filename_or_obj, engine, chunks, cache, decode_cf, mask_and_scale, decode_times, decode_timedelta, use_cftime, concat_characters, decode_coords, drop_variables, inline_array, chunked_array_type, from_array_kwargs, backend_kwargs, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">665</span>     <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">backend_kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">667</span> <span class="k">if</span> <span class="n">engine</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">668</span>     <span class="n">engine</span> <span class="o">=</span> <span class="n">plugins</span><span class="o">.</span><span class="n">guess_engine</span><span class="p">(</span><span class="n">filename_or_obj</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">670</span> <span class="k">if</span> <span class="n">from_array_kwargs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">671</span>     <span class="n">from_array_kwargs</span> <span class="o">=</span> <span class="p">{}</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/xarray/backends/plugins.py:194,</span> in <span class="ni">guess_engine</span><span class="nt">(store_spec)</span>
<span class="g g-Whitespace">    </span><span class="mi">186</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">187</span>     <span class="n">error_msg</span> <span class="o">=</span> <span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">188</span>         <span class="s2">&quot;found the following matches with the input file in xarray&#39;s IO &quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">189</span>         <span class="sa">f</span><span class="s2">&quot;backends: </span><span class="si">{</span><span class="n">compatible_engines</span><span class="si">}</span><span class="s2">. But their dependencies may not be installed, see:</span><span class="se">\n</span><span class="s2">&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">190</span>         <span class="s2">&quot;https://docs.xarray.dev/en/stable/user-guide/io.html </span><span class="se">\n</span><span class="s2">&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">191</span>         <span class="s2">&quot;https://docs.xarray.dev/en/stable/getting-started-guide/installing.html&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">192</span>     <span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">194</span> <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>

<span class="ne">ValueError</span>: did not find a match in any of xarray&#39;s currently installed IO backends [&#39;netcdf4&#39;]. Consider explicitly selecting one of the installed engines via the ``engine`` parameter, or installing additional IO dependencies, see:
<span class="ne">https</span>://docs.xarray.dev/en/stable/getting-started-guide/installing.html
<span class="ne">https</span>://docs.xarray.dev/en/stable/user-guide/io.html
</pre></div>
</div>
</div>
</div>
<p><em><strong>Figure 2</strong>. Static maps of some of the soil hydraulic properties.</em></p>
<blockquote>
<div><p><strong>Note</strong>. For a detailed description of each of the input maps, including the abreviations used to identify them, please refer to this <a class="reference external" href="https://ec-jrc.github.io/lisflood-model/4_1_annex_input-files/">link</a>.</p>
</div></blockquote>
</section>
<section id="dynamic-maps">
<h4>2.1.2 Dynamic maps<a class="headerlink" href="#dynamic-maps" title="Link to this heading">#</a></h4>
<p>Some of the maps, instead, are dynamic, i.e., they change over time. In our case, since we have decided to simulate land use change and water use change, there are three sets of maps with temporal evolution.</p>
<p><strong>Leaf area index (LAI)</strong></p>
<p>Leaf area index has an annual cycle, therefore, representative maps for the evolution of LAI over a generic year must be provided. LAI maps are the only compulsory dynamic maps. In this example, we provide 10-day average LAI maps (36 maps per year) for forest (<code class="docutils literal notranslate"><span class="pre">laif.nc</span></code>), irrigated (<code class="docutils literal notranslate"><span class="pre">laii.nc</span></code>) and other (<code class="docutils literal notranslate"><span class="pre">laio.nc</span></code>) land uses; you can find them in the folder <code class="docutils literal notranslate"><span class="pre">maps/vegetation/</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># load and plot some map stacks</span>
<span class="n">variables</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;laif&#39;</span><span class="p">:</span> <span class="s1">&#39;LAI forest&#39;</span><span class="p">,</span> 
    <span class="s1">&#39;laii&#39;</span><span class="p">:</span> <span class="s1">&#39;LAI irrigated&#39;</span><span class="p">,</span> 
    <span class="s1">&#39;laio&#39;</span><span class="p">:</span> <span class="s1">&#39;LAI other&#39;</span>
<span class="p">}</span>
<span class="n">lai</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">var</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">variables</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">path_model</span> <span class="o">/</span> <span class="s1">&#39;maps&#39;</span> <span class="o">/</span> <span class="s1">&#39;vegetation&#39;</span> <span class="o">/</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">.nc&#39;</span><span class="p">)</span>
    <span class="n">ds</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="c1"># extract the LAI variable</span>
    <span class="n">da</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;Band1&#39;</span><span class="p">]</span>
    <span class="c1"># set representative timesteps</span>
    <span class="n">da</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">periods</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">sizes</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;10d&#39;</span><span class="p">)</span>
    <span class="c1"># set attributes</span>
    <span class="n">da</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="n">da</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;long_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
    <span class="n">da</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span>
    <span class="n">lai</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="n">da</span>

<span class="c1"># plot maps and timeseries of LAI</span>
<span class="n">plot_mapstacks</span><span class="p">(</span><span class="n">lai</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">6.8</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Leaf area index&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/2fcf022364de5c57c25a53189668f4bc047f8aff9e1f1200c660cd7707730cf2.png" src="_images/2fcf022364de5c57c25a53189668f4bc047f8aff9e1f1200c660cd7707730cf2.png" />
</div>
</div>
<p><em><strong>Figure 3</strong>. Leaf Area Index maps for different land covers. The maps on top show the mean annual LAI, whereas the lineplot at the bottom the evolution over time of the mean catchment LAI.</em></p>
<blockquote>
<div><p><strong>Note</strong>. Check this <a class="reference external" href="https://ec-jrc.github.io/lisflood-code/4_Static-Maps_leaf-area-index/">link</a> for more info about the use of LAI maps in LISFLOOD.</p>
</div></blockquote>
<p><strong>Transient water use</strong></p>
<p>In this use case, we have decided to model the change in water use over the study period. The following plot shows how the water use is distributed spatially across the catchment and its evolution over time.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># load and plot some map stacks</span>
<span class="n">water_use</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;dom&#39;</span><span class="p">,</span> <span class="s1">&#39;ene&#39;</span><span class="p">,</span> <span class="s1">&#39;ind&#39;</span><span class="p">,</span> <span class="s1">&#39;liv&#39;</span><span class="p">]:</span>
    <span class="n">da</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataarray</span><span class="p">(</span><span class="n">path_model</span> <span class="o">/</span> <span class="s1">&#39;maps&#39;</span> <span class="o">/</span> <span class="s1">&#39;water_use&#39;</span> <span class="o">/</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">.nc&#39;</span><span class="p">)</span>
    <span class="n">da</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">water_use</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="n">da</span>

<span class="c1"># calculate minimum and maximum values of soil moisture among all the map stacks</span>
<span class="n">vmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">da</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="k">for</span> <span class="n">var</span><span class="p">,</span> <span class="n">da</span> <span class="ow">in</span> <span class="n">water_use</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
<span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">da</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="k">for</span> <span class="n">var</span><span class="p">,</span> <span class="n">da</span> <span class="ow">in</span> <span class="n">water_use</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>

<span class="n">plot_mapstacks</span><span class="p">(</span><span class="n">water_use</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;water use&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/96978a58f5fc27567c48d8b34337664cc54239c0ae5d735ce20dfed1ebfe0dff.png" src="_images/96978a58f5fc27567c48d8b34337664cc54239c0ae5d735ce20dfed1ebfe0dff.png" />
</div>
</div>
<p><em><strong>Figure 4</strong>. Transient water use for 4 types of consumption (<em>dom</em>: domestic, <em>ene</em>: energy, <em>ind</em>: industry, <em>liv</em>: livestock). The maps on top show mean consumption over the study period, whereas the lineplot at the bottom shows the evolution over time of the mean catchment water use.</em></p>
<p>The maps above show that water use is concentrated in a few cells over the catchment. The lineplot shows that, in our case, water use has increased in the last few decades, and that the domestic consumption has a seasonal cycle.</p>
<p><strong>Land use change</strong></p>
<p>To reproduce land use change, we provide LISFLOOD with monthly maps of the fraction of each cell devoted to each land use. The files are located in the folder <code class="docutils literal notranslate"><span class="pre">maps/land_use/dynamic</span></code>. For instance, let’s see the evolution of the six land covers (forest, irrigated, other, water bodies, urban and rice) over the 41 year period:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">land_use</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;forest&#39;</span><span class="p">,</span> <span class="s1">&#39;irrigated&#39;</span><span class="p">,</span> <span class="s1">&#39;other&#39;</span><span class="p">,</span> <span class="s1">&#39;rice&#39;</span><span class="p">,</span> <span class="s1">&#39;sealed&#39;</span><span class="p">,</span> <span class="s1">&#39;water&#39;</span><span class="p">]:</span>
    <span class="n">da</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataarray</span><span class="p">(</span><span class="n">path_model</span> <span class="o">/</span> <span class="s1">&#39;maps&#39;</span> <span class="o">/</span> <span class="s1">&#39;land_use&#39;</span> <span class="o">/</span> <span class="s1">&#39;dynamic&#39;</span> <span class="o">/</span> <span class="sa">f</span><span class="s1">&#39;frac</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">.nc&#39;</span><span class="p">)</span>
    <span class="n">da</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">land_use</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="n">da</span>

<span class="n">plot_mapstacks</span><span class="p">(</span><span class="n">land_use</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/ddb0671191ef5ce67cea93f8f1632043ce30bf043e576fd9689cec3c158072c0.png" src="_images/ddb0671191ef5ce67cea93f8f1632043ce30bf043e576fd9689cec3c158072c0.png" />
</div>
</div>
<p><em><strong>Figure 5</strong>. Land use change. Maps represent average over time, whereas the timeseries represents average over the entire catchment.</em></p>
<p>In our study area, the majority of the catchment belongs to either forest or the “other” fraction, with a diverging trend between the two of them. Forest cover has slightly increased, whereas the “other” fraction has decreased. The irrigated and rice cultivation areas are mostly in the lower part of the catchment, whereas the water bodies mainly refer to the reservoir. It is important to notice that the sum of all fractions must be 1.</p>
<p>The data provided with the use case also includes in folder <code class="docutils literal notranslate"><span class="pre">maps/land_use/static/</span></code> the same land use fraction maps for a simulation without land use change. In that case, each file contains a unique map that applies to the whole simulation period.</p>
<blockquote>
<div><p><strong>Note</strong>. Check this <a class="reference external" href="https://ec-jrc.github.io/lisflood-model/3_13_optLISFLOOD_TransientLandUseChange/">link</a> for more information about the simulation of land use change in LISFLOOD.</p>
</div></blockquote>
</section>
</section>
<section id="meteorological-forcings">
<h3>2.2 Meteorological forcings<a class="headerlink" href="#meteorological-forcings" title="Link to this heading">#</a></h3>
<p>They are provided in the folder <code class="docutils literal notranslate"><span class="pre">meteo</span></code>. Five map stacks are required: air temperature 2 m above ground (<em>2t</em>), potential evaporation (<em>e0</em>), potential evaporation from bare soil (<em>eS0</em>), potential evapotranspiration (<em>eT0</em>) and precipitation (<em>tp</em>). A netCDF file is supplied for each meteorological variable; each file contains the daily maps for the 41 years of data available.</p>
<p>Similarly to the maps, the meteorological forcings were created applying the <code class="docutils literal notranslate"><span class="pre">cutmaps</span></code> tool to the global dataset developed by the GloFAS team. The use of the GloFAS meteorological dataset is not mandatory; on the contrary, we encourage users to use their preferred meteorological datasets. The only requirement is that the meteorological forcings must match the spatial definition (coordinate reference system, resolution and grid) of the static maps. The repository <a class="reference external" href="https://github.com/ec-jrc/pyg2p"><code class="docutils literal notranslate"><span class="pre">pyg2p</span></code></a> developed by the LISFLOOD team can be useful for these tasks.</p>
<p>Let’s inspect one of these files, e.g., the air temperature.</p>
<blockquote>
<div><p><strong>Warning</strong>. To be able to run the following cell, unzip the file <code class="docutils literal notranslate"><span class="pre">LF_mekong_usecase/meteo/2t.zip</span></code> in your repository.</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># load the temperature stack map</span>
<span class="n">T</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">path_model</span> <span class="o">/</span> <span class="s1">&#39;meteo&#39;</span> <span class="o">/</span> <span class="s1">&#39;2t.nc&#39;</span><span class="p">)</span>

<span class="c1"># check the dimensions of the data</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Data dimensions: </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">dims</span><span class="p">))</span>

<span class="c1"># extract the temperature variable</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">T</span><span class="p">[</span><span class="s1">&#39;2t&#39;</span><span class="p">]</span>
<span class="n">t</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

<span class="c1"># create a simple plot of the data</span>
<span class="n">plot_map_timeseries</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;temperature [°C]&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">)</span>

<span class="n">T</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Data dimensions: FrozenMappingWarningOnValuesAccess({&#39;lon&#39;: 29, &#39;lat&#39;: 36, &#39;time&#39;: 14975})
</pre></div>
</div>
<img alt="_images/8731db75f551041cb2f3d437c890e68cc40c499441191677358c3fc57b50b711.png" src="_images/8731db75f551041cb2f3d437c890e68cc40c499441191677358c3fc57b50b711.png" />
</div>
</div>
<p><em><strong>Figure 6</strong>. Air temperature. On the left, a map of the mean temperature; on the right, a time series of mean areal temperature.</em></p>
<blockquote>
<div><p><strong>Exercise</strong>. Try to inspect the other meteorological datasets.</p>
</div></blockquote>
</section>
<section id="tables">
<h3>2.3 Tables<a class="headerlink" href="#tables" title="Link to this heading">#</a></h3>
<p>LISFLOOD uses tables (TXT files) to provide specific parameters for the lake and reservoir simulation. In this use case, since there are no lakes in the catchment, we only require these text files for the reservoir simulation (see folder <code class="docutils literal notranslate"><span class="pre">tables/reservoirs</span></code>). Each of the TXT files is a two-entry table; the first column represents the reservoir ID and the second column the value of the corresponding variable.</p>
<p>As an example, the following code snippet corresponds to the file <code class="docutils literal notranslate"><span class="pre">rnormq.txt</span></code>, which defines the normal reservoir outflow (159.1 m³/s) for the Nam Ngum Reservoir (which in the GloFAS dataset has ID 530).</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>530 159.1
</pre></div>
</div>
<p>The location of the reservoir is defined in a static map (<code class="docutils literal notranslate"><span class="pre">maps/reservoirs/reservoirs.nc</span></code>), that only contains values representing the reservoir ID at the dam locations. In our case, this map contains only one value (530) that defines the location of our reservoir.</p>
</section>
</section>
<section id="general-setup">
<h2>3 General setup<a class="headerlink" href="#general-setup" title="Link to this heading">#</a></h2>
<section id="runs">
<h3>3.1 Runs<a class="headerlink" href="#runs" title="Link to this heading">#</a></h3>
<p>As mentioned above, the objective of this use case is to have a climatology of river discharge in three points of the Nam Ngum River. To do so, a simulation of 30 years needs to be done. Before we proceed with the run, we must both initialize the LISFLOOD model of the catchment and warmup the state variables. In total, we will simulate three runs:</p>
<ul class="simple">
<li><p>An <strong>initialization run</strong> to estimate the average discharge in the river network (required by the kinematic wave split routing) and the average inflow in the lower groundwater zone (required to estimate the initial conditions of the lower groundwater zone). Please, read this <a class="reference external" href="https://ec-jrc.github.io/lisflood-code/3_step5_model-initialisation/">link</a> for further information on LISFLOOD initialization.</p></li>
<li><p>A <strong>warm-up run</strong> to estimate the state variables at the beginning of the period of interest. This run is not mandatory for a simulation like ours. It is done here only to show how the end states of a simulation can be applied as the initial conditions of a succeeding simulation. A simpler and more common approach is to simulate the main run with default initial conditions and to discard the first few years of the results, assuming that the results at the beginning of the simulation are not reliable due to unrealistic initial conditions.</p></li>
<li><p>The actual <strong>30-year run</strong>.</p></li>
</ul>
<p>The following figure shows the extent of these three simulations in our case study. The meteorological data spans from 01-01-1979 to 31-12-2019, so 41 years of data are available. It is recommended that the initialization run be as long as possible; therefore, the 41 years of data are used for this run. To warm up the model we use the first 11 years of data (1979-1990) and the remaining 30 years are used for the actual run.</p>
<p><img alt="Run explanation" src="_images/3_run_explanation.png" /></p>
<p><em><strong>Figure 7</strong>. Time periods of the three runs. The initialization run expands the complete 41 years of meteorological data. This period is divided in a warmup run (11 first years) and the actual run (30 years).</em></p>
</section>
<section id="general-settings">
<h3>3.2 General settings<a class="headerlink" href="#general-settings" title="Link to this heading">#</a></h3>
<p>The Nam Ngum river catchment has a set of particularities for which it was chosen as a use case.</p>
<ul class="simple">
<li><p>There is a reservoir that regulates approximately half of the catchment.</p></li>
<li><p>There is an extensive area of the catchment dedicated to rice production.</p></li>
<li><p>We want to include in the simulation the change over time of both water demand and land use.</p></li>
<li><p>We want to apply split kinematic wave routing.</p></li>
<li><p>The maps are in a geographic coordinate system (latitude and longitude), so we must input maps for pixel length and area (activation via option <code class="docutils literal notranslate"><span class="pre">gridSizeUserDefined</span></code> in the settings file).</p></li>
</ul>
<p>With all these requirements, we can start working from the <a class="reference external" href="https://github.com/ec-jrc/lisflood-code/blob/master/src/lisfloodSettings_reference.xml">default settings file</a> and define our specific settings.</p>
<section id="model-options">
<h4>3.2.1 Model options<a class="headerlink" href="#model-options" title="Link to this heading">#</a></h4>
<p>These are the LISFLOOD modules activated in the <code class="docutils literal notranslate"><span class="pre">&lt;lfoptions&gt;</span></code> element of the settings file:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;lfoptions&gt;</span>

<span class="w">    </span>#<span class="w"> </span>[...]
<span class="w">    </span>
<span class="w">    </span><span class="nt">&lt;setoption</span><span class="w"> </span><span class="na">choice=</span><span class="s">&quot;1&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;gridSizeUserDefined&quot;</span><span class="nt">/&gt;</span>

<span class="w">    </span>#<span class="w"> </span>option<span class="w"> </span>to<span class="w"> </span>read/write<span class="w"> </span>NetCDF
<span class="w">    </span><span class="nt">&lt;setoption</span><span class="w"> </span><span class="na">choice=</span><span class="s">&quot;1&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;readNetcdfStack&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;setoption</span><span class="w"> </span><span class="na">choice=</span><span class="s">&quot;1&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;writeNetcdfStack&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;setoption</span><span class="w"> </span><span class="na">choice=</span><span class="s">&quot;1&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;writeNetcdf&quot;</span><span class="nt">/&gt;</span>

<span class="w">    </span>#<span class="w"> </span>options<span class="w"> </span>to<span class="w"> </span>turn<span class="w"> </span>hydrological<span class="w"> </span>modules<span class="w"> </span>on/off
<span class="w">    </span><span class="nt">&lt;setoption</span><span class="w"> </span><span class="na">choice=</span><span class="s">&quot;1&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;wateruse&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;setoption</span><span class="w"> </span><span class="na">choice=</span><span class="s">&quot;1&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;TransientWaterDemandChange&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;setoption</span><span class="w"> </span><span class="na">choice=</span><span class="s">&quot;1&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;TransientLandUseChange&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;setoption</span><span class="w"> </span><span class="na">choice=</span><span class="s">&quot;1&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;wateruseRegion&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;setoption</span><span class="w"> </span><span class="na">choice=</span><span class="s">&quot;1&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;drainedIrrigation&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;setoption</span><span class="w"> </span><span class="na">choice=</span><span class="s">&quot;1&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;riceIrrigation&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;setoption</span><span class="w"> </span><span class="na">choice=</span><span class="s">&quot;1&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;openwaterevapo&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;setoption</span><span class="w"> </span><span class="na">choice=</span><span class="s">&quot;1&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;simulateReservoirs&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;setoption</span><span class="w"> </span><span class="na">choice=</span><span class="s">&quot;1&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;SplitRouting&quot;</span><span class="nt">/&gt;</span>

<span class="w">    </span>#<span class="w"> </span>[...]

<span class="nt">&lt;/lfoptions&gt;</span>
</pre></div>
</div>
<p>These options apply to the three runs (<code class="docutils literal notranslate"><span class="pre">settings_initialization.xml</span></code>, <code class="docutils literal notranslate"><span class="pre">settings_warmup.xml</span></code> and <code class="docutils literal notranslate"><span class="pre">settings_run.xml</span></code>). As we will see in the following notebooks, other options will change depending on the run.</p>
</section>
<section id="calibration-parameters">
<h4>3.2.2 Calibration parameters<a class="headerlink" href="#calibration-parameters" title="Link to this heading">#</a></h4>
<p>Among the multiple model parameters in LISFLOOD, the recommended calibration procedure focuses on tuning a smaller set of parameters. These calibration parameters can be found in the settings file within the element <code class="docutils literal notranslate"><span class="pre">&lt;lfusers&gt;</span></code>; the comments on each of these paremeters show their default value. We will start running our catchment model with these default values.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;textvar</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;UpperZoneTimeConstant&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;10&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;textvar</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;LowerZoneTimeConstant&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;100&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;textvar</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;GwPercValue&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;0.5&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;textvar</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;GwLoss&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;0&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;textvar</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;LZThreshold&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;$(PathSoilHyd)/lzthreshold_Global_03min.nc&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;textvar</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;b_Xinanjiang&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;0.7&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;textvar</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;PowerPrefFlow&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;3.5&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;textvar</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;CalChanMan&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;2.0&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;textvar</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;CalChanMan2&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;3.0&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;textvar</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;SnowMeltCoef&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;4&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;textvar</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;LakeMultiplier&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;1&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;textvar</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;adjust_Normal_Flood&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;0.8&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;textvar</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;ReservoirRnormqMult&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;1.0&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;textvar</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;QSplitMult&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;2&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
<blockquote>
<div><p><strong>Note</strong>. Bear in mind that the default parameter values are simply a way to start the model, but they should be calibrated against observations in your specific catchment. The <a class="reference external" href="https://github.com/ec-jrc/lisflood-calibration">LISFLOOD-calibration repository</a> is a possible way of calibrating your model, but you can use any other procedure.</p>
</div></blockquote>
</section>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="README.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">A LISFLOOD use case: the Nam Ngum River Basin</p>
      </div>
    </a>
    <a class="right-next"
       href="1_initialization.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Initialization run</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#study-area">1 Study area</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#input-data">2 Input data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#maps">2.1 Maps</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#static-maps">2.1.1 Static maps</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#dynamic-maps">2.1.2 Dynamic maps</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#meteorological-forcings">2.2 Meteorological forcings</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tables">2.3 Tables</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#general-setup">3 General setup</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#runs">3.1 Runs</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#general-settings">3.2 General settings</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#model-options">3.2.1 Model options</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#calibration-parameters">3.2.2 Calibration parameters</a></li>
</ul>
</li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Joint Research Center - European Commission
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>